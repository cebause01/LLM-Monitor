<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LLM Performance Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .modal-bg {
      background-color: rgba(0,0,0,0.6);
    }
    .modal-content {
      max-height: 70vh;
      overflow-y: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    const App = () => {
      const [results, setResults] = useState([
        {
          id: 1,
          model: 'LLAMA 3.3',
          prompt: 'You are a clinical assistant analyzing peritoneal dialysis data...',
          output: '### 1. Patient Summary\nThe patient is identified by the ID "85h49272ha"...',
          issue: `1. UF values are wrong\n2. Anomaly detection failed\n3. Misleading summary\n4. Incorrect table`
        }
      ]);

      const [showModal, setShowModal] = useState(false);
      const [modalTitle, setModalTitle] = useState('');
      const [modalContent, setModalContent] = useState('');
      const [showForm, setShowForm] = useState(false);
      const [newEntry, setNewEntry] = useState({
        model: '',
        prompt: '',
        output: '',
        issue: ''
      });

      // Open modal with title & content
      const openModal = (title, content) => {
        setModalTitle(title);
        setModalContent(content);
        setShowModal(true);
      };
      const closeModal = () => setShowModal(false);

      // Truncate text for table cells
      const truncateText = (text, len) => {
        if (!text) return '';
        return text.length <= len ? text : text.slice(0, len) + '...';
      };

      // Handle form field changes
      const handleInputChange = (e) => {
        const { name, value } = e.target;
        setNewEntry(prev => ({ ...prev, [name]: value }));
      };

      // Submit form: add new entry
      const handleFormSubmit = (e) => {
        e.preventDefault();
        const newId = results.length ? Math.max(...results.map(r => r.id)) + 1 : 1;
        setResults([...results, { id: newId, ...newEntry }]);
        setNewEntry({ model: '', prompt: '', output: '', issue: '' });
        setShowForm(false);
        alert('Entry added! Click "Get Updated HTML" to copy the full updated code.');
      };

      // Generate full HTML code with current data embedded
      const generateHTMLCode = () => {
        // Escape double quotes and backslashes in text fields for safety
        const escapeJSString = (str) =>
          str.replace(/\\/g, '\\\\').replace(/`/g, '\\`').replace(/\$/g, '\\$');

        const resultsJS = results.map(r => ({
          id: r.id,
          model: escapeJSString(r.model),
          prompt: escapeJSString(r.prompt),
          output: escapeJSString(r.output),
          issue: escapeJSString(r.issue),
        }));

        return `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LLM Performance Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-gray-100">
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;
    const App = () => {
      const [results] = useState(${JSON.stringify(resultsJS, null, 2)});
      const truncateText = (text, len) => (text.length <= len ? text : text.slice(0, len) + '...');
      return (
        <div className="min-h-screen p-6 bg-gray-100">
          <div className="max-w-6xl mx-auto bg-white shadow-lg rounded p-6">
            <h1 className="text-3xl font-bold mb-6">LLM Performance Dashboard</h1>
            <table className="w-full table-auto border-collapse border border-gray-300">
              <thead>
                <tr className="bg-gray-50">
                  <th className="border border-gray-300 px-4 py-2">Model</th>
                  <th className="border border-gray-300 px-4 py-2">Prompt</th>
                  <th className="border border-gray-300 px-4 py-2">Output</th>
                  <th className="border border-gray-300 px-4 py-2">Issue</th>
                </tr>
              </thead>
              <tbody>
                {results.map(r => (
                  <tr key={r.id} className="hover:bg-gray-100">
                    <td className="border border-gray-300 px-4 py-2">{truncateText(r.model, 30)}</td>
                    <td className="border border-gray-300 px-4 py-2">{truncateText(r.prompt, 40)}</td>
                    <td className="border border-gray-300 px-4 py-2">{truncateText(r.output, 40)}</td>
                    <td className="border border-gray-300 px-4 py-2">{truncateText(r.issue, 40)}</td>
                  </tr>
                ))}
              </tbody>
            </table>
            <p className="mt-4 text-gray-600 text-sm italic">This is a static snapshot of the saved entries.</p>
          </div>
        </div>
      );
    };
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  <\/script>
</body>
</html>`;
      };

      return (
        <div className="min-h-screen bg-gray-100 p-6">
          <div className="max-w-6xl mx-auto bg-white shadow-lg rounded-lg p-8">
            <div className="flex justify-between items-center mb-6">
              <h1 className="text-4xl font-extrabold text-gray-900">LLM Performance Dashboard</h1>
              <div className="space-x-2">
                <button
                  onClick={() => setShowForm(!showForm)}
                  className="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700"
                >
                  {showForm ? 'Close Form' : 'New Entry'}
                </button>
                <button
                  onClick={() => openModal('Full Updated HTML Code', generateHTMLCode())}
                  className="px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700"
                >
                  Get Updated HTML
                </button>
              </div>
            </div>

            {showForm && (
              <form
                onSubmit={handleFormSubmit}
                className="mb-8 bg-gray-50 rounded p-6 shadow-md space-y-4"
              >
                <input
                  type="text"
                  name="model"
                  value={newEntry.model}
                  onChange={handleInputChange}
                  placeholder="Model"
                  className="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-300"
                  required
                />
                <textarea
                  name="prompt"
                  value={newEntry.prompt}
                  onChange={handleInputChange}
                  placeholder="Prompt"
                  rows={3}
                  className="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-300"
                  required
                />
                <textarea
                  name="output"
                  value={newEntry.output}
                  onChange={handleInputChange}
                  placeholder="Output"
                  rows={3}
                  className="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-300"
                  required
                />
                <textarea
                  name="issue"
                  value={newEntry.issue}
                  onChange={handleInputChange}
                  placeholder="Issue"
                  rows={3}
                  className="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-300"
                  required
                />
                <button
                  type="submit"
                  className="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                >
                  Add Entry
                </button>
              </form>
            )}

            <table className="w-full border-collapse border border-gray-300">
              <thead>
                <tr className="bg-gray-50">
                  <th className="border border-gray-300 px-4 py-2 text-left">Model</th>
                  <th className="border border-gray-300 px-4 py-2 text-left">Prompt</th>
                  <th className="border border-gray-300 px-4 py-2 text-left">Output</th>
                  <th className="border border-gray-300 px-4 py-2 text-left">Issue</th>
                </tr>
              </thead>
              <tbody>
                {results.map(({ id, model, prompt, output, issue }) => (
                  <tr key={id} className="hover:bg-gray-100">
                    <td className="border border-gray-300 px-4 py-2">{truncateText(model, 30)}</td>
                    <td className="border border-gray-300 px-4 py-2">{truncateText(prompt, 40)}</td>
                    <td className="border border-gray-300 px-4 py-2">{truncateText(output, 40)}</td>
                    <td className="border border-gray-300 px-4 py-2">{truncateText(issue, 40)}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          {showModal && (
            <div
              className="modal-bg fixed inset-0 flex items-center justify-center z-50 p-4"
              onClick={closeModal}
              role="dialog"
              aria-modal="true"
            >
              <div
                className="bg-white rounded-lg shadow-lg max-w-5xl w-full p-6 relative"
                onClick={e => e.stopPropagation()}
              >
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-xl font-bold">{modalTitle}</h2>
                  <button
                    onClick={closeModal}
                    className="text-gray-500 hover:text-gray-900 text-3xl font-bold leading-none"
                    aria-label="Close modal"
                  >
                    &times;
                  </button>
                </div>
                <pre className="modal-content whitespace-pre-wrap text-sm text-gray-800">{modalContent}</pre>
                <div className="mt-4 text-right">
                  <button
                    onClick={closeModal}
                    className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                  >
                    Close
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
